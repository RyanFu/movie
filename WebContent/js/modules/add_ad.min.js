window.AddAd=function(a){this.adSlotPage="";this.adOrderPage="";this.curId="";this.ad_type="";this.platform="";this.template="";this.entryType="";this.langdingSize="";
this.isTextLandingType=false;this.stepTwoRequest=true;this.adDialogId="";this.adSlotExistDialogId="";this.data={addButtonLisner:"div.panel_btn_top",editButtonLisner:"#tb_list",adslotStrict:false};
this.textSizeAdSlot="";this.region=new window.Region({type:"ad"});$.extend(this.data,a);};window.AddAd.prototype={initUI:function(){var a=this;$(".ui_radio_pre").click(function(){$(this).toggleClass("ui_radio_checked");
$(".ui_radio_pre").not(this).removeClass("ui_radio_checked");$(".blue").next("input").each(function(){$(this).prop("disabled",!$(this).closest("div").prev("div").find("a.ui_radio_pre").hasClass("ui_radio_checked"));
});$("input[name='priceType']").val($(this).hasClass("ui_radio_checked")?$(this).attr("pricetype"):"none");$("input[name='costPrice']").val($(this).hasClass("ui_radio_checked")?$(this).closest("div").next("div").find("input").val():"");
});$(".close_adlist").click(function(){$(".msg_ad").unblock({onUnblock:function(){a.adSlotExistDialogId="";$("body").css({"overflow-y":"auto"});}});});
$("#choose_ad_item").delegate('tr input[name="record_ch"]',"click",function(){$('#choose_ad_item input[name="record_ch"]').not($(this)).prop("checked",false);
});$("#adListForUseContainer .btns .btn_save_ad2").click(function(){var b=$('#choose_ad_item input[name="record_ch"]:checked');if(b.length>0){$.ajax({type:"get",url:"/ad/edit2/"+b.val(),data:{rnd:Math.random()},beforeSend:function(c){},success:function(c,d){a.initMsgAd2(c);
},complete:function(c,d){},error:function(){alert("请求失败");}});}else{alert("请先选中一个已有广告!");}});$(".ui_radio_net").click(function(){$(this).toggleClass("ui_radio_checked");
if($.trim($(this).text())=="所有网络"){$(".ui_radio_net")[$(this).hasClass("ui_radio_checked")?"addClass":"removeClass"]("ui_radio_checked");}else{if($(".ui_radio_net").not(":first").filter(".ui_radio_checked").length<3){$(".ui_radio_net").first().removeClass("ui_radio_checked");
}else{$(".ui_radio_net").first().addClass("ui_radio_checked");}}$('input[name="networks"]').val($(".ui_radio_net").not(":first").filter(".ui_radio_checked").map(function(b,c){return $(c).attr("net");
}).get().join(","));});$(".blue").next("input").keyup(function(){$("input[name='costPrice']").val($(this).val());});$("input[name='budget']").unbind("click").click(function(){$("input[name='budgetLimit']").prop("disabled",$("input[name='budget']:eq(0)").prop("checked"));
});$("a.ad_icon_return").click(function(){$(".step2").hide();$(".step1").show();adjustMsg();a.stepTwoRequest=false;});$("#adLandingSize").bind("change",function(){a.changeAdPreviewSize($(this).val());
});$(".type_switch input[type=file]").change(function(){upload(this,$(this).attr("filetype"),$(this).attr("feedback"),"changeUploadStyle","#ad_form",a.landingSize);
});$(".previewName,.previewDes").keyup(function(){$("#"+$(this).attr("forshow")).text($(this).val());});$("#textColorPicker").change(function(){a.textPreviewChange();
});$('input[name="textFont"],input[name="textSize"]').change(function(){a.textPreviewChange();});$(".ui_select_textFont .pop_menu ul").fontPicker({valueLink:"textFont"});
$(".ui_select_textSize .pop_menu ul").fontSizePicker({valueLink:"textSize"});$("#inputiTunes").click(function(){a.getDataFromiTunes($(this).prev().val());
});$(".ui_radio_type").click(function(){if(!$(this).hasClass("ui_radio_disabled")){$(".ui_radio_type").removeClass("ui_radio_checked");$(this).addClass("ui_radio_checked");
$("input[name='contentType']").val($(this).attr("title"));if($(this).attr("title")=="web"){$(".ui_select_landingType .pop_menu ul li").eq(2).find("a").trigger("click");
}else{if(a.platform!="iOS"){$(".ui_select_landingType .pop_menu ul li").eq(0).find("a").trigger("click");}else{$(".ui_select_landingType .pop_menu ul li").eq(4).find("a").trigger("click");
}}a.changeFormStyle();}});$(".ui_radio_form").click(function(){if(!$(this).hasClass("ui_radio_disabled")){$(".ui_radio_form").removeClass("ui_radio_checked");
$(this).addClass("ui_radio_checked");$("input[name='displayType']").val($(this).attr("style_type"));a.isTextLandingType=$(this).attr("style_type")=="text";
a.changeFormStyle();}});$("#datepicker_ad_start").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"hh:mm",changeYear:true,changeMonth:true,monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesMin:["日","一","二","三","四","五","六"],timeText:"时间",hourText:"时",minuteText:"分",currentText:"现在",closeText:"确定",onClose:function(c,b){$(this).blur();
},onSelect:function(c){var b=$(this).datetimepicker("getDate");$("#datepicker_ad_end").datetimepicker("option","minDate",new Date(b.getTime()));}});$("#datepicker_ad_end").datetimepicker({dateFormat:"yy-mm-dd",timeFormat:"hh:mm",changeYear:true,changeMonth:true,monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesMin:["日","一","二","三","四","五","六"],timeText:"时间",hourText:"时",minuteText:"分",currentText:"现在",closeText:"确定",beforeShow:function(b){setTimeout(function(){var c=$(b).datepicker("widget").find(".ui-datepicker-buttonpane");
c.find(".ui-datepicker-clear").remove();$("<button>",{text:"不设置",click:function(){$("#datepicker_ad_end").val("").datepicker("hide").blur();}}).appendTo(c).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all");
},1);},onChangeMonthYear:function(b){setTimeout(function(){var c=$(b).datepicker("widget").find(".ui-datepicker-buttonpane");c.find(".ui-datepicker-clear").remove();
$("<button>",{text:"不设置",click:function(){$("#datepicker_ad_end").val("").datepicker("hide").blur();}}).appendTo(c).addClass("ui-datepicker-clear ui-state-default ui-priority-primary ui-corner-all");
},1);},onClose:function(f,e){var d=$("#datepicker_ad_start");if(d.val()!=""){var c=new Date(d.val());var b=new Date(f);if(c>b){d.val(f);}}else{d.val(f);
}$(this).blur();},onSelect:function(c){var b=$(this).datetimepicker("getDate");$("#datepicker_ad_start").datetimepicker("option","maxDate",new Date(b.getTime()));
}});$(".tb_inner_wrap").delegate("#list_adslot tr td input","click",function(){a.changeAdslotCheck();});$(a.data.addButtonLisner).delegate(".btn_add_ad","click",function(b){var c=a.adDialogId=getToken();
$("input[name='adid']").val("");$.ajax({type:"get",url:"/ad/add1",dataType:"json",data:"rnd="+Math.random(),success:function(f,g){if(c!=a.adDialogId){return;
}a.adSlotPage=f.adSlotPage.result;a.adOrderPage=f.adOrderPage.result;var d=-1;if($(".btn_add_ad").parents("tr.expend_panel").length>0){d=$(".btn_add_ad").parents("tr.expend_panel").prev("tr").find("td").eq(0).find("input").val();
var e=$(".btn_add_ad").closest("tr.expend_panel").prev("tr").attr("id").replace("tr_","");}a.showMsg(new a.AD1(),function(){$.unblockUI({onUnblock:function(){a.adDialogId="";
a.updateItem($(b.target));$("body").css({"overflow-y":"auto"});}});},d,e,b);}});});$(a.data.editButtonLisner).delegate("td.edit_btn a","click",function(b){a.editAD($(this).attr("adpage_id"),b);
});},AD1:function(q,c,b,r,p,d,a,s,m,l,g,n,j,f,k){this.adOrderId=q;this.name=c;this.budget=b;this.budgetLimit=r;if(p!=""){this.priceType=p;this.costPrice=d;
}this.fixedRank=k;this.areas=a;this.networks=s;this.channels=m;this.adSlotId=l;this.startTime=g;this.landingSize=j;this.platform=f;try{if($.trim(n.toString())!="00:00:00"){this.endTime=n;
}}catch(o){var h=formatdate(new Date(n),"yyyy-MM-dd HH:mm");if($.trim(h)!="00:00:00"){this.endTime=n;}}},verifyAD1:function(){$(".err").remove();return verify_null($("input[name='adname']"),"",true,null,{maxLength:16})&&verify_null($("input[name='li_adslot']"),"所属广告位不能为空",true)&&verify_null($("input[name='startTime']"),"时间不能为空")&&($("input[name='budget']").eq(0).prop("checked")||$("input[name='budget']").eq(1).prop("checked")&&verify_null($("input[name='budgetLimit']"),"不能为空",false))&&($("a.ui_radio_pre").filter(".ui_radio_checked").length==0||verify_null($("input[name='costPrice']"),"计价不能为空",false,$("a.ui_radio_pre").filter(".ui_radio_checked").parent().next(),{num:true}))&&verify_null($("input[name='adareas']"),"投放区域不能为空")&&verify_null($("input[name='networks']"),"网络不能为空")&&($("#fixedRank").val()===""||$("#fixedRank").val()!==""&&verify_null($("#fixedRank"),"",false,null,{digits:true}));
},getAD1:function(){var k=[],m=this;$("input[name='li_adslot']").val("");$("input[name='record_adslot']:checked").each(function(){k.push($(this).val());
$("input[name='li_adslot']").val(k.join(""));});if(m.verifyAD1()){var o=($("#list_order option:selected").text()!="请选择订单"?$("#list_order option:selected").val():""),c=$("input[name='adname']").val(),b=$("input[name='budget']:checked").val(),p=$("input[name='budgetLimit']").val(),n=$("input[name='priceType']").val(),d=$("input[name='costPrice']").val(),a=$("input[name='adareas']").val(),q=$("input[name='networks']").val(),j=$("input[name='channels']").val(),f=m.platform,g=m.landingSize,h=$("#fixedRank").val(),e=($.trim($("input[name='startTime']").val())+" 00:00").replace(/(\d{2}:\d{2})\s?(00:00)?\s?/,"$1:00"),l=($.trim($("input[name='endTime']").val())+" 00:00").replace(/(\d{2}:\d{2})\s?(00:00)?\s?/,"$1:00");
return new m.AD1(o,c,b,p,n,d,a,q,j,k,e,l,g,f,h);}else{return;}},AD2:function(p,c,g,f,k,m,l,b,j,o,h,e,a,n,d){this.contentType=p;this.landingType=c;this.landingSize=g;
this.displayType=f;this.title=k;this.adWords=m;this.provider=l;this.url=b;this.icon=j;this.description=o;this.img=h;if(this.displayType=="text"){this.textFont=e;
this.textSize=a;this.textColor=n;}this.platform=d;},verifyAD2:function(){var a=this;return $("tr.type_switch:has(.f_req)").map(function(){if(a.platform!="iOS"){if($(this).hasClass(a.ad_type)){var b=$(this).find('input[type="hidden"],input[type="text"],textarea');
if(b.attr("verify")=="file"){return verify_file(b,b.attr("title"),b.attr("rule"))?1:0;}else{if(b.attr("verify")=="area"){return verify_null(b,"",false,null,{maxLength:500})?1:0;
}else{if(b.attr("verify")=="adWords"){return verify_null(b,"",false,null,{maxLength:20})?1:0;}else{if(b.attr("verify")=="url"){return verify_null(b,"",false,null,{url:"yes"})?1:0;
}else{return verify_null(b,b.attr("title"))?1:0;}}}}}}else{if(($(this).hasClass(a.ad_type)&&!$(this).hasClass("android"))||$(this).hasClass("ios")){var b=$(this).find('input[type="hidden"],input[type="text"],textarea');
if(b.attr("verify")=="file"){return verify_file(b,b.attr("title"),b.attr("rule"))?1:0;}else{if(b.attr("verify")=="area"){return verify_null(b,"",false,null,{maxLength:500})?1:0;
}else{if(b.attr("verify")=="adWords"){return verify_null(b,"",false,null,{maxLength:20})?1:0;}else{return verify_null(b,b.attr("title"))?1:0;}}}}}}).get().join("");
},getAD2:function(){var j=this;var e=$("#url"),r=$("#icon"),q=$("input[name='contentType']"),c=$("input[name='adLandingType']"),h=$("input[name='displayType']"),f=$("input[name='appname']").parents("tr.type_switch").hasClass(j.ad_type)?$("input[name='appname']"):$("input[name='webname']"),n=$("input[name='adWords']"),m=$("input[name='provider']"),b=$("input[name='url']").parents("tr.type_switch").hasClass(j.ad_type)?e:$("input[name='weburl']"),l=$("input[name='icon']").parents("tr.type_switch").hasClass(j.ad_type)?r:$("input[name='weblogo']"),g=$("#bannerimg"),d="",a=$('input[name="textSize"]'),p=$('input[name="textColor"]'),o=$("textarea[name='description']");
if(j.platform=="iOS"){b=$("input[name='weburl']");}j.landingSize=$("#adLandingSize").val();var k=j.verifyAD2();if(k.split("1").length==(parseInt(k.length)+1)){return new j.AD2(q.val(),c.val(),j.landingSize,h.val(),f.val(),n.val(),m.val(),b.val(),l.val(),o.val(),g.val(),d,a.val(),p.val(),j.platform);
}else{return;}},changeAdslotCheck:function(){var b=$("#list_adslot tr td input"),c=this,a=b.filter(":checked").eq(0);b.prop("disabled",false).closest("tr").css({color:"black",cursor:"auto"});
c.stepTwoRequest=true;if(a.length>0){(function(){c.platform=a.closest("tr").find("td.platform").text();c.template=a.closest("tr").find("td.platform").attr("template");
c.entryType=a.closest("tr").find("td.entryType").attr("entryType");c.landingSize=a.closest("tr").find("td.landing_size").text();c.textSizeAdSlot=a.closest("tr").find("td.textSizeAdSlot").attr("textSizeAdSlot");
b.each(function(){if($(this).closest("tr").find("td.platform").text()!=c.platform||$(this).closest("tr").find("td.landing_size").text()!=c.landingSize){$(this).prop("disabled",true);
$(this).closest("tr").css({color:"grey",cursor:"not-allowed"});}});})();}},initMsgAd1:function(d,a,b,f){$(".step1").show();$(".step2").hide();$(".err").remove();
var e=this;if(d.name!=undefined){$("input[name='adname']").val(d.name);}else{$("input[name='adname']").val("");}(function(){var g=e.adOrderPage.length;
var j="";for(var h=0;h<g;h++){j+='<option value="'+e.adOrderPage[h].id+'" '+((b==e.adOrderPage[h].id)?" selected ":"")+" >"+e.adOrderPage[h].name+"</option>";
}$("#list_order").html("").append('<option value="0">请选择订单</option>'+j);})();if(d.adOrderId){$("#list_order option[value='"+d.adOrderId+"']").attr("selected",true);
}(function(){var g=e.adSlotPage.length;if(g>0){var h={bigimage:"轮播大图",embed:"内嵌入口",banner:"横幅",custom:"自定义入口",wap:"网页",push:"全屏广告",text:"文字链"};$(".tb_inner_wrap th input").prop("checked",false);
$("input[name='li_adslot']").val("");var l="";for(var j=0;j<g;j++){l+='<tr><td width="1"><input type="checkbox"  name="record_adslot" value="'+e.adSlotPage[j].id+'" ';
l+='/></td><td width="95">'+e.adSlotPage[j].name+'</td><td width="60" class="entryType" entryType="'+e.adSlotPage[j].landing_type+'">'+h[e.adSlotPage[j].landing_type]+'</td><td width="80">'+(e.adSlotPage[j].app_name!=undefined?e.adSlotPage[j].app_name:"-")+'</td><td width="60" class="platform" template="'+e.adSlotPage[j].template+'">'+e.adSlotPage[j].platform+'</td><td width="60" class="landing_size textSizeAdSlot opensize" opensize="'+(e.adSlotPage[j].opensize||"")+'" textSizeAdSlot="'+(e.adSlotPage[j].text_size!=undefined?e.adSlotPage[j].text_size:"")+'" >'+(e.adSlotPage[j].landing_type!="text"?e.adSlotPage[j].landing_size:"-")+"</td></tr>";
}$("#list_adslot").html("").append(l);if(a>0){var m=$("#list_adslot input[type='checkbox'][value="+a+"]");m.prop("checked",true);}if(d.adSlotId){for(var k=0;
k<d.adSlotId.length;k++){$("#list_adslot input[type='checkbox'][value="+d.adSlotId[k]+"]").prop("checked",true);}}}else{$("#list_adslot").html("<tr><td>请先创建广告位...</td></tr>");
}e.changeAdslotCheck();})();if(d.startTime){$("input[name='startTime']").val(formatdate(new Date(d.startTime),"yyyy-MM-dd HH:mm"));}else{$("input[name='startTime']").val(formatdate(new Date(),"yyyy-MM-dd HH:mm"));
}if(d.endTime){$("input[name='endTime']").val(formatdate(new Date(d.endTime),"yyyy-MM-dd HH:mm"));}else{$("input[name='endTime']").val("");}(function(){$("input[name='budget']:eq(0)").prop("checked",true);
$("input[name='budgetLimit']").val("");if(d.budget=="limit"){$("input[name='budget']:eq(1)").trigger("click");if(d.budgetLimit){$("input[name='budgetLimit']").val(d.budgetLimit).prop("disabled",false);
}}else{$("input[name='budget']:eq(0)").trigger("click");}$(".ui_radio_pre").removeClass("ui_radio_checked");$("input[name='priceType']").val("");$("#price_input_impression,#price_input_click,#price_input_download").val("").prop("disabled",true);
var g={impression:0,click:1,download:2};if(d.priceType&&d.priceType!="none"){$("input[name='priceType']").val(d.priceType);$(".ui_radio_pre:eq("+g[d.priceType]+")").addClass("ui_radio_checked");
$("#price_input_"+d.priceType+",input[name='costPrice']").val(d.costPrice).prop("disabled",false);}else{$("input[name='costPrice']").val("");}})();e.region.initAreas(d.areas);
var c=$(".ui_radio_net");c.removeClass("ui_radio_checked");$("input[name='networks']").val("");if(d.networks){$("input[name='networks']").val(d.networks);
c.each(function(g,h){if(d.networks.indexOf($(h).text())>-1){$(h).addClass("ui_radio_checked");}});if(c.filter(".ui_radio_checked").length>2){$(".ui_radio_net").first().addClass("ui_radio_checked");
}}else{$(".ui_radio_net").first().trigger("click");}if(d.channels){$("input[name='channels']").val(d.channels);}else{$("input[name='channels']").val("");
}if(d.fixedRank){$("#fixedRank").val(d.fixedRank);}else{$("#fixedRank").val("");}},initMsgAd2:function(e){var f=this;$(".msg_ad").unblock({onUnblock:function(){f.adSlotExistDialogId="";
}});$(".step1").hide();$(".step2").show();adjustMsg();$(".err").remove();$(".ui_radio_type").removeClass("ui_radio_checked");$(".ui_radio_form").removeClass("ui_radio_checked");
$("input[name='appname']").val("");$("input[name='adWords']").val("");$("input[name='provider']").val("");$("input[name='weburl']").val("http://");$("input[name='webname']").val("");
$("input[name='icon']").val("");$("input[name='url']").val("");$("input[name='weblogo']").val("");$("input[name='bannerimg']").val("");$("textarea[name='description']").val("");
$("input[type='file']").val("");$('input[name="textFont"]').val("");$(".ui_select_textFont span.text").text("请选择字体");$('input[name="textSize"]').val(f.textSizeAdSlot!==""?f.textSizeAdSlot:"");
$(".ui_select_textSize span.text").text(f.textSizeAdSlot!==""?f.textSizeAdSlot:"请选择字体大小");$('input[name="textColor"]').val("#000000").css("background","#000000");
$("#icon_show").attr("src","");$("#name_show").text("");$("#des_show").text("");$("#bannerimg_show").attr("src","");$(".ui_radio_form,.ui_radio_type").removeClass("ui_radio_checked ui_radio_disabled");
$("#bannerOrBigImg").text("横幅图片");if(e.adContent){f.landingSize=e.adContent.landingSize||f.landingSize;f.platform=e.adContent.platform||f.platform;}$("#adLandingSize").val(f.landingSize);
$(".ui_select_landingSize span.text").text(f.landingSize).attr("title",f.landingSize);var g={banner:{adType:[true,true],adStyle:[true,true,false]},custom:{adType:[true,true],adStyle:[true,false,false]},bigimage:{adType:[true,true],adStyle:[false,true,false]},embed:{adType:[true,true],adStyle:[true,false,false]},wap:{adType:[true,true],adStyle:[true,true,false]},push:{adType:[true,true],adStyle:[true,true,true]},text:{adType:[true,false],adStyle:[false,false,true]}};
f.isTextLandingType=false;var a=[true,true],c=[true,true,true];var b=$("input[name='record_adslot']:checked").eq(0).closest("tr").find("td.opensize").attr("opensize");
if(f.entryType=="push"&&b=="messagebox"){a=[true,false];c=[false,false,true];}else{a=g[f.entryType].adType;c=g[f.entryType].adStyle;}$(".ui_radio_form").each(function(k,l){if(!c[k]){$(l).addClass("ui_radio_disabled");
}});$(".ui_radio_type").each(function(k,l){if(!a[k]){$(l).addClass("ui_radio_disabled");}});if(e.adContent){$("#adLandingType").val(e.adContent.landingType);
(function(){var n={web:0,app:1},l={standard:0,image:1,text:2};var m=$(".tb_form").find(".ui_radio_type").eq(n[e.adContent.contentType]);var k=$(".tb_form").find(".ui_radio_form").eq(l[e.adContent.displayType]);
f.isTextLandingType=e.adContent.displayType=="text";m.addClass("ui_radio_checked");$("input[name='contentType']").val(e.adContent.contentType);k.addClass("ui_radio_checked");
$("input[name='displayType']").val(e.adContent.displayType);})();f.initStep2();if(e.adContent.url&&($("input[name='weburl']").parents("tr.type_switch").hasClass(f.ad_type)||f.platform=="iOS")){$("input[name='weburl']").val(e.adContent.url);
}if(f.platform=="android"&&e.adContent.url&&$("input[name='url']").parents("tr.type_switch").hasClass(f.ad_type)){$("input[name='url']").val(e.adContent.url);
}if(e.adContent.icon&&$("input[name='weblogo']").parents("tr.type_switch").hasClass(f.ad_type)){$("input[name='weblogo']").val(e.adContent.icon);$("#icon_show").attr("src",e.adContent.icon);
}if(e.adContent.icon&&$("input[name='icon']").parents("tr.type_switch").hasClass(f.ad_type)){$("input[name='icon']").val(e.adContent.icon);$("#icon_show").attr("src",e.adContent.icon);
}if(e.adContent.img){$("input[name='bannerimg']").val(e.adContent.img);$("#bannerimg_show").attr("src",e.adContent.img);}if(e.adContent.title){if($("input[name='appname']").parents("tr.type_switch").hasClass(f.ad_type)){$("input[name='appname']").val(e.adContent.title);
$("#name_show").text(e.adContent.title);}else{if($("input[name='webname']").parents("tr.type_switch").hasClass(f.ad_type)){$("input[name='webname']").val(e.adContent.title);
$("#name_show").text(e.adContent.title);}}}if(e.adContent.adWords){$("input[name='adWords']").val(e.adContent.adWords);$("#des_show").text(e.adContent.adWords);
}if(e.adContent.provider){$("input[name='provider']").val(e.adContent.provider);}if(e.adContent.description&&$("textarea[name='description']").parents("tr.type_switch").hasClass(f.ad_type)){$("textarea[name='description']").val(e.adContent.description);
}if(e.adContent.textFont){$('input[name="textFont"]').val(e.adContent.textFont);$(".ui_select_textFont span.text").text(e.adContent.textFont);}if(e.adContent.textSize){$('input[name="textSize"]').val(e.adContent.textSize);
$(".ui_select_textSize span.text").text(e.adContent.textSize);}if(e.adContent.textColor){$('input[name="textColor"]').val(e.adContent.textColor).css("background",e.adContent.textColor);
}}else{var h=$(".ui_radio_type").not(".ui_radio_disabled");var j=h.length==1?h.eq(0):h.eq(1);var d=$(".ui_radio_form").not(".ui_radio_disabled").eq(0);
$("input[name='contentType']").val(j.attr("title"));$("input[name='displayType']").val(d.attr("style_type"));j.trigger("click");d.trigger("click");}if(f.isTextLandingType){f.textPreviewChange();
}changeUploadStyle();},initStep2:function(){var d=this,f={android:{app:{download:"直接下载",detail:"详细界面",iosOrAndroidName:"网址:",inputOpen:false},web:{browser:"浏览器",webview:"内嵌网页",iosOrAndroidName:"网址:",inputOpen:false}},iOS:{app:{gotoAppStore:"GotoAppStore",download:"GotoAppStore",detail:"GotoAppStore",iosOrAndroidName:"苹果应用链接:",inputOpen:true},web:{gotoAppStore:"GotoAppStore",browser:"浏览器",webview:"内嵌网页",iosOrAndroidName:"网址:",inputOpen:false}}},e=$("input[name='contentType']").val(),a=$("input[name='adLandingType']").val(),b=$("input[name='displayType']").val(),c=$(".msg_content_center tr.type_switch");
$("span.iosOrAndroidName").text(f[d.platform][e]["iosOrAndroidName"]);$("div.ui_select_landingType span.text").html(f[d.platform][e][a]);if(f[d.platform][e]["inputOpen"]){$("#inputiTunes").removeClass("hidden");
}else{$("#inputiTunes").addClass("hidden");}if(e==="app"){$(".adwords_toggle_title").text("推广文字：");}else{$(".adwords_toggle_title").text("网站简介：");}d.ad_type=$(".tb_form .ui_radio_type,.tb_form .ui_radio_form").map(function(){return $(this).hasClass("ui_radio_checked")?1:0;
}).get().join("");c.hide().filter("."+d.ad_type).show();if(d.platform=="iOS"){c.filter(".android").hide().end().filter(".ios").show();}$(".ui_select_landingSize .pop_menu ul li").hide().filter(function(){return $(this).hasClass(d.platform)&&$(this).hasClass(b)&&$(this).hasClass(d.entryType);
}).show();$(".ui_select_landingType .pop_menu ul li").show().not("."+d.platform).hide().end().not("."+e).hide();if($("#bannerimg").closest("tr.type_switch").hasClass(d.ad_type)){$("#icon_show,#name_show,#des_show").hide();
$("#bannerimg_show").show();}else{$("#name_show").show();$("#bannerimg_show").hide();if(d.isTextLandingType){$("#icon_show,#des_show").hide();$("#name_show").addClass("textFont_show");
}else{$("#icon_show,#des_show").show();$("#name_show").removeClass("textFont_show").removeAttr("style");}}adjustMsg();d.previewChange();changeUploadStyle();
},changeFormStyle:function(){var d=this,e={android:{banner:{size:"202x55"},wap:{standard:"202x55",image:{applist:"424x380",horizon_bigimage:"424x380",vertical_bigimage:"380x424"}},embed:{size:"202x55"},push:{size:"-",standard:"202x55",image:{applist:"424x380",horizon_bigimage:"424x380",vertical_bigimage:"380x424"}},bigimage:{size:"800x250"},custom:{size:"202x55"},text:{size:"-"}},iOS:{banner:{size:"320x50"},wap:{standard:"320x50",image:{applist:"480x320",horizon_bigimage:"480x320",vertical_bigimage:"320x480"}},embed:{size:"320x50"},push:{size:"-",standard:"320x50",image:{applist:"480x320",horizon_bigimage:"480x320",vertical_bigimage:"320x480"}},bigimage:{size:"640x320"},custom:{size:"320x50"},text:{size:"-"}}},c=$("input[name='record_adslot']:checked").eq(0).closest("tr").find("td.opensize").attr("opensize"),b=$("input[name='displayType']").val();
if(d.entryType=="wap"||(d.entryType=="push"&&c!="messagebox")){if(b=="image"){var a=e[d.platform][d.entryType][b][d.template];$(".ui_select_landingSize span.text").text(a).attr("title",a);
$("#adLandingSize").val(a);}else{var a=e[d.platform][d.entryType][b];$(".ui_select_landingSize span.text").text(a).attr("title",a);$("#adLandingSize").val(a);
}}else{var a=e[d.platform][d.entryType].size;$(".ui_select_landingSize span.text").text(a).attr("title",a);$("#adLandingSize").val(a);}d.initStep2();adjustMsg();
d.previewChange();changeUploadStyle();},initExistAdList:function(e){var a=e.adPage.result,c="",d=true;if(a.length>0){for(var b=0;b<a.length;b++){c+="<tr class="+(d===true?"":"transbg")+' id="tr_'+a[b].id+'">';
d=!d;c+='<td width="140"  class="chk pos_rel" style="display:block"><input id="input_'+a[b].id+'" type="checkbox" name="record_ch" value="'+a[b].id+'"/>';
c+='<a class="edit_btn" href="javascript:void(0)" adpage_id="'+a[b].id+'" class="tb_adname"><label title="'+a[b].name+'" for="input_'+a[b].id+'">'+a[b].name+"</label></a></td>";
if(a[b].content_type=="app"){c+='<td width="100" class="tb_adtype">应用推广</td>';}else{c+='<td width="100" class="tb_adtype">网站推广</td>';}c+='<td width="130">'+(a[b].start_time!==undefined?formatdate(new Date(a[b].start_time),"yyyy-MM-dd HH:mm"):"-")+"</td>";
c+='<td width="130">'+(a[b].end_time!==undefined?formatdate(new Date(a[b].end_time),"yyyy-MM-dd HH:mm"):"-")+"</td>";c+='<td width="" id="td_status_'+a[b].id+'" style="text-align:left; " class="status">';
if(a[b].status=="normal"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_normal.gif" width="16" height="16" alt="正常" />正常';
}else{if(a[b].status=="limit"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_top.gif" width="16" height="16" alt="到达预算" />到达预算';
}else{if(a[b].status=="adorder_pause"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_pause.gif" width="16" height="16" alt="订单暂停" />订单暂停';
}else{if(a[b].status=="adorder_finish"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_complete.gif" width="16" height="16" alt="订单投放完成" />订单投放完成';
}else{if(a[b].status=="finish"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_complete.gif" width="16" height="16" alt="投放完成" />投放完成';
}else{if(a[b].status=="adorder_ready"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_abled.gif" width="16" height="16" alt="订单尚未投放" />订单尚未投放';
}else{if(a[b].status=="ready"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_abled.gif" width="16" height="16" alt="尚未投放" />尚未投放';
}else{if(a[b].status=="pause"){c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_pause.gif" width="16" height="16" alt="暂停" />暂停';
}else{c+='<img style="vertical-align:text-bottom;margin-right:3px;" src="images/icon_state_disabled.gif" width="16" height="16" alt="未知" />未知';}}}}}}}}c+="</td></tr>";
}$("#choose_ad_item").html(c);}else{$("#choose_ad_item .loadingStatus").text("没有匹配广告位!");}},showMsg:function(c,j,e,g,b){var f=this;f.initMsgAd1(c,e,g,b);
var d=$(".msg_ad"),k=null,h=null;popBox(d);$("input[name='adname']").blur().focus();$(".close").unbind("click").click(function(){$.unblockUI({onUnblock:function(){f.adDialogId="";
$("body").css({"overflow-y":"auto"});}});});$(".btn_use_pastad").unbind("click").click(function(){k=f.getAD1();var l="";if(k){$.ajax({type:"get",url:"/ad/add2",data:{platform:f.platform,landingSize:f.landingSize},dataType:"json",beforeSend:function(m){var n=$("#adListForUseContainer");
$(".msg_ad").block({message:n,css:{border:0,background:"none",height:"430px",width:"680px"},onBlock:function(){f.adSlotExistDialogId=getToken();l=f.adSlotExistDialogId;
}});},success:function(m,n){if(l!=f.adSlotExistDialogId){return;}f.initExistAdList(m);},complete:function(m,n){},error:function(){$(".loadingStatus").text("请求失败!");
}});}});$(".btn_continue_ad").unbind("click").click(function(){k=f.getAD1();var l=f.adDialogId;if(k){if(!f.stepTwoRequest){$(".step1").hide();$(".step2").show();
adjustMsg();return;}if($("input[name='adid']").val()===""){f.initMsgAd2({});}else{$.ajax({type:"get",url:"/ad/edit2/"+$("input[name='adid']").val(),data:{rnd:Math.random()},beforeSend:function(m){},success:function(m,n){if(l!=f.adDialogId){return;
}f.initMsgAd2(m);},complete:function(m,n){},error:function(){alert("请求失败");}});}adjustMsg();}});function a(){h=f.getAD2();if(h){$(this).unbind("click");
if($("input[name='adid']").val()!==""){h.id=f.curId;}h.rnd=Math.random();var m=$.extend(k,h);var l="/ad/save";$.ajax({type:"get",url:l,dataType:"json",data:m,beforeSend:function(n){},success:function(n,o){if(n.status=="ok"){j();
}else{alert("保存失败!");$(".btn_save_ad").unbind("click").click(function(){a.apply(this);});}},complete:function(n,o){},error:function(){$(".btn_save_ad").unbind("click").click(function(){a.apply(this);
});alert("保存失败!");}});}}$(".btn_save_ad").unbind("click").click(function(){a.apply(this);});},changeAdPreviewSize:function(c){var b=this,a={android:{width:"202",height:"55"},iOS:{width:"320",height:"50"}};
b.landingSize=c||b.landingSize;if(b.landingSize!="-"){var d=b.landingSize.split("x")[0],e=b.landingSize.split("x")[1];$(".preview").width(d/(1+(parseInt(d)>400||parseInt(e)>200)));
$(".preview").height(e/(1+(parseInt(e)>200||parseInt(d)>400)));if($.inArray(b.landingSize,["480x320","424x380","800x250","640x320","380x424","320x480"])>-1){$("#bannerOrBigImg").text("大图图片");
}else{$("#bannerOrBigImg").text("横幅图片");}$("#name_show,#des_show").css("max-width",(parseInt(d)-60)+"px");}else{$(".preview").width(a[b.platform].width);
$(".preview").height(a[b.platform].height);$("#name_show,#des_show").css("max-width",a[b.platform].width+"px");}adjustMsg();},textPreviewChange:function(){var a={"font-family":$('input[name="textFont"]').val(),"font-size":fontSizes[$('input[name="textSize"]').val()],color:$('input[name="textColor"]').val()};
$("#name_show").css(a);},previewChange:function(){$(".previewBannerImg,.previewLogo").each(function(){if($(this).closest(".type_switch").is(":visible")){if($(this).val()!==""){$("#"+$(this).attr("forshow")).attr("src",$(this).val()+"?"+Math.random());
}else{$("#"+$(this).attr("forshow")).attr("src","/images/no_img.gif?"+Math.random());}}});$(".previewName,.previewDes").filter(":visible").each(function(){$("#"+$(this).attr("forshow")).text($(this).val());
});this.changeAdPreviewSize($("#adLandingSize").val());if(this.isTextLandingType){this.textPreviewChange();}},editAD:function(e,b){var a=this;a.curId=e;
a.stepTwoRequest=true;a.adDialogId=getToken();$("input[name='adid']").val(e);var d=$(b.target),c=a.adDialogId;$.ajax({type:"get",url:"/ad/edit1/"+e,dataType:"json",data:"rnd="+Math.random(),beforeSend:function(f){},success:function(f,h){if(c!=a.adDialogId){return;
}a.adSlotPage=f.adSlotPage.result;a.adOrderPage=f.adOrderPage.result;var g=[];for(i=0;i<f.adHolderList.length;i++){g.push(f.adHolderList[i].adSlotId);}f.ad.adSlotId=g;
a.showMsg(f.ad,function(){$.unblockUI({onUnblock:function(){a.adDialogId="";a.updateItem(d);$("body").css({"overflow-y":"auto"});}});},-1,"",b);},complete:function(f,g){},error:function(){}});
},getDataFromiTunes:function(a){$.getJSON("http://itunes.apple.com/lookup?jsoncallback=?",{id:a.replace(/.*id(\d{9})/g,"$1")},function(b){alert(b);});},updateItem:function(f,b,c,a){var d=f.closest(".tb_inner_wrap");
d.append("<div class='loading_row'><div class='txt'>正在刷新数据&nbsp;&nbsp;&nbsp;<img src='images/loading_m.gif' /></div></div>");if(location.pathname=="/ad"){loadList($("#pager span").text());
}else{var e=$("tr.expend_panel").prev().attr("id").replace("tr_","");adList.param.listUrl=adList.param.baseUrl+e;adList.loadList(adList.param.data.pageNo,$("tr.expend_panel").prev(),true);
}}};