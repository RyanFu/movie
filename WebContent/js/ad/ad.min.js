$(function(){loadList(1);var a=new window.AddAd({addButtonLisner:".panel_btn_top"});a.initUI();a.region.initUI();$(":checkbox").prop("checked",false);});
function loadList(b,a){$.ajax({type:"get",url:"ad/list?pageNo="+b+(a?a:""),dataType:"json",data:"rnd="+Math.random(),beforeSend:function(c){},success:function(g,e){loginValidate(g);
var k=g;var d=k.adPage.result;var h=k.adPage.totalPages;var c=k.adPage.pageNo;var j=d.length;var l=true;pageAnchorsGenerate(h,c,"",loadList);if(!k.adPage||k.adPage.result.length==0){$("#tb_list tr").not(":first").remove();
$("#tb_list").append('<tr id="loading_row_init"><td colspan="4">没有记录!</td></tr>');return;}clearList();for(i=0;i<j;i++){var f="";f+="<tr class="+(l==true?"":"transbg")+' id="tr_'+d[i].id+'">';
l=!l;f+='<td class="chk pos_rel" style="display:block"><input type="checkbox" name="record_ch" value="'+d[i].id+'"/></td>';f+='<td class="edit_btn" title="'+d[i].name+'"><a href="javascript:void(0)" adpage_id="'+d[i].id+'" class="tb_adname">'+d[i].name+"</a></td>";
f+='<td class=" platform" platform="'+d[i].platform+'"><img src="/imgs/'+d[i].platform+'.gif"/></td>';f+='<td class="tb_ad_slot_name" title="'+(d[i].ad_slot_name?d[i].ad_slot_name:"-")+'">'+(d[i].ad_slot_name?d[i].ad_slot_name:"-")+"</td>";
f+="<td>"+(d[i].start_time?formatdate(new Date(d[i].start_time),"yyyy-MM-dd HH:mm"):"-")+"</td>";f+="<td>"+(d[i].end_time?formatdate(new Date(d[i].end_time),"yyyy-MM-dd HH:mm"):"-")+"</td>";
f+='<td style="position:relative;display:block;" id="td_level_'+d[i].id+'" style="text-align:left; padding:0 30px;" class="level">';f+='<div class="pnl"><div style="text-align:center;">';
f+='<span class="lvl i'+d[i].prior+" prior_img_"+d[i].id+'"></span></div>';f+='<ul style="padding:10px;">';f+='<li><input type="radio" name="prior_'+d[i].id+'" id="prior1_'+d[i].id+'"';
if(d[i].prior==1){f+='checked="checked" ';}f+='onclick="$(&quot;#prior_input_'+d[i].id+'&quot;).val(1);$(this).closest(&quot;.pnl&quot;).find(&quot;.lvl&quot;).removeClass(&quot;i1 i2 i3&quot;).addClass(&quot;i1&quot;)"/><label for="prior1_'+d[i].id+'">&nbsp;低级</label></li>';
f+='<li><input type="radio" name="prior_'+d[i].id+'" id="prior2_'+d[i].id+'"';if(d[i].prior==2){f+='checked="checked" ';}f+='onclick="$(&quot;#prior_input_'+d[i].id+'&quot;).val(2);$(this).closest(&quot;.pnl&quot;).find(&quot;.lvl&quot;).removeClass(&quot;i1 i2 i3&quot;).addClass(&quot;i2&quot;)"/><label for="prior2_'+d[i].id+'">&nbsp;中级</label></li>';
f+='<li><input type="radio" name="prior_'+d[i].id+'" id="prior3_'+d[i].id+'"';if(d[i].prior==3){f+='checked="checked" ';}f+='onclick="$(&quot;#prior_input_'+d[i].id+'&quot;).val(3);$(this).closest(&quot;.pnl&quot;).find(&quot;.lvl&quot;).removeClass(&quot;i1 i2 i3&quot;).addClass(&quot;i3&quot;)"/><label for="prior3_'+d[i].id+'">&nbsp;高级</label></li>';
f+="</ul>";f+='<input type="hidden" id="prior_input_'+d[i].id+'" value=""/>';f+='<div class="opr">';f+='<span class="btn_save"><a href="javascript:void(0)" onclick="';
f+="updatePrior("+d[i].id+", '/ad/prior?prior=' + $('#prior_input_"+d[i].id+"').val() + '&id="+d[i].id+"');return false;";f+='">保存</a></span>';f+='<span class="btn_cancel"><a href="javascript:void(0)">取消</a></span>';
f+="</div></div>";f+='<span class="lvl i'+d[i].prior+" prior_img_"+d[i].id+'"><a href="javascript:void(0)" onclick="showPrior(&quot;td_level_'+d[i].id+'&quot;)" ></a></span>';
f+="</td>";f+='<td id="td_status_'+d[i].id+'" style="text-align:left;" class="status">';if(d[i].status=="normal"){f+='<img src="images/icon_state_normal.gif" width="16" height="16" alt="正常" />正常';
}else{if(d[i].status=="limit"){f+='<img src="images/icon_state_top.gif" width="16" height="16" alt="到达预算" />到达预算';}else{if(d[i].status=="adorder_pause"){f+='<img src="images/icon_state_pause.gif" width="16" height="16" alt="订单暂停" />订单暂停';
}else{if(d[i].status=="adorder_finish"){f+='<img src="images/icon_state_complete.gif" width="16" height="16" alt="订单投放完成" />订单投放完成';}else{if(d[i].status=="finish"){f+='<img src="images/icon_state_complete.gif" width="16" height="16" alt="投放完成" />投放完成';
}else{if(d[i].status=="adorder_ready"){f+='<img src="images/icon_state_abled.gif" width="16" height="16" alt="订单尚未投放" />订单尚未投放';}else{if(d[i].status=="ready"){f+='<img src="images/icon_state_abled.gif" width="16" height="16" alt="尚未投放" />尚未投放';
}else{if(d[i].status=="pause"){f+='<img src="images/icon_state_pause.gif" width="16" height="16" alt="暂停" />暂停';}else{f+='<img src="images/icon_state_disabled.gif" width="16" height="16" alt="未知" />未知';
}}}}}}}}f+="</td></td>";f+='<td class="edit_btn"><a href="javascript:void(0)" adpage_id="'+d[i].id+'" class="icon_modify">编辑</a></td>';f+="</tr>";$("#tb_list").append(f);
}},complete:function(c,d){},error:function(){}});}function clearList(){$("#tb_list tr").not(".tit").remove();}function showPrior(a){$(".level .pnl").hide();
var b=$("#"+a+".level .pnl");if(b.next("span").hasClass("i1")){b.find("li").eq(0).find("input:radio").trigger("click");}else{if(b.next("span").hasClass("i2")){b.find("li").eq(1).find("input:radio").trigger("click");
}else{b.find("li").eq(2).find("input:radio").trigger("click");}}b.show();b.find(".btn_cancel").unbind("click").click(function(){$(".level .pnl").hide();
});}function updatePrior(b,a){$.ajax({type:"GET",url:a,data:"rnd="+Math.random(),success:function(c){loginValidate(c);$("#td_level_"+b+".level .pnl").hide();
$(".prior_img_"+b).removeClass("i1 i2 i3");$(".prior_img_"+b).addClass("i"+$("#prior_input_"+b).val());}});}