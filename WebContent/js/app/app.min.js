var status,appDialogId="";$(function(){loadList(1);$(".btn_add_app").click(function(){appDialogId=getToken();initMsg("","","");$(".btn_save").unbind("click").click(function(){if(verify_null($("input[name='name']"),"应用名称不能为空！")&&verify_null($("input[name='platform']"),"平台不能为空！",true)){var b=$("input[name='name']").val();
var a=$("input[name='platform']").val();var c=$("textarea[name='description']").val();$.ajax({type:"get",url:"/app/save?name="+b+"&platform="+a+"&description="+c,data:"rnd="+Math.random(),dataType:"json",beforeSend:function(d){},success:function(d,e){if(d.status=="ok"){$.unblockUI({onUnblock:function(){appDialogId="";
}});loadList(1);}},complete:function(d,e){},error:function(){}});}});});$(window).resize(function(){adjustMsg();});});function clearList(){$("#tb_list tr").each(function(a){if($(this).attr("class")!="tit"){$(this).remove();
}});}function loadList(b,a){$.ajax({type:"get",url:"app/list?pageNo="+b+(a?a:""),dataType:"json",data:"rnd="+Math.random(),beforeSend:function(c){},success:function(g,e){var k=g;
var d=k.appPage.result;var h=k.appPage.totalPages;var c=k.appPage.pageNo;var j=d.length;var l=true;clearList();pageAnchorsGenerate(h,c,"",loadList);if(!k.appPage||k.appPage.result.length==0){$("#tb_list tr").not(":first").remove();
$("#tb_list").append('<tr id="loading_row_init"><td colspan="4">没有记录!</td></tr>');return;}for(i=0;i<j;i++){var f="";f+="<tr class="+(l==true?"":"transbg")+' id="tr_'+d[i].id+'">';
l=!l;f+='<td class="pos_rel chk" style="display:block"><input type="checkbox" name="record_ch" value="'+d[i].id+'"></td>';f+='<td><a href="javascript:void(0)" onclick="editApp('+d[i].id+',event)" class="tb_name">'+d[i].name+"</a></td>";
f+='<td id="td_status_'+d[i].id+'" style="text-align:left; padding:0 30px;">';if(d[i].status.indexOf("normal")>-1){f+='<img src="images/icon_state_normal.gif" width="16" height="16" alt="正常" />正常';
}else{f+='<img src="images/icon_state_pause.gif" width="16" height="16" alt="暂停" />暂停';}f+="</td>";f+='<td class="tb_platform">'+d[i].platform+"</td>";
f+="<td>"+d[i].ad_slot_count+"</td>";f+='<td><a href="javascript:void(0)" class="icon_modify" onclick="editApp('+d[i].id+',event)">编辑</a></td>';f+="</tr>";
$("#tb_list").append(f);}},complete:function(c,d){},error:function(){}});}function updateItem(c,b,a){setTimeout(function(){$(".loading_row").remove();c.find(".tb_name").html(b);
c.find(".tb_platform").html(a);},1000);}function initMsg(c,b,e){$(".err").remove();if(c&&c!=""){$(".msg_content_top .title span").eq(0).text("编辑应用");}else{$(".msg_content_top .title span").eq(0).text("新建应用");
}$("input[name='name']").val(c);$(".ui_radio").removeClass("ui_radio_checked");if(b=="android"){$(".android").parent().addClass("ui_radio_checked");}else{if(b=="iOS"){$(".ios").parent().addClass("ui_radio_checked");
}}$("input[name='platform']").val(b);$("textarea[name='description']").val(e);var f=$(".msg_app");var a=$(window).height();var d=$(document).width();$.blockUI({css:{color:"#cccccc",border:"0",width:"818px",left:d/2-(f.width()/2),top:a/2-(f.height()/2),background:"none",padding:"0px"},message:$(".msg_app"),});
$(".close").unbind("click").click(function(){$.unblockUI({onUnblock:function(){appDialogId="";}});});$(".ui_radio_os").click(function(){$(".ui_radio_os").removeClass("ui_radio_checked");
$(this).addClass("ui_radio_checked");});}function editApp(d,a){var c=null;c=$(a.target);var b=appDialogId=getToken();$.ajax({type:"get",url:"/app/edit/"+d,dataType:"json",data:"rnd="+Math.random(),beforeSend:function(e){},success:function(e,f){if(b!=appDialogId){return;
}initMsg(e.app.name,e.app.platform,e.app.description);$(".btn_save").unbind("click").click(function(){if(verify_null($("input[name='name']"),"应用名称不能为空！")&&verify_null($("input[name='platform']"),"平台不能为空！",true)){var h=$("input[name='name']").val();
var g=$("input[name='platform']").val();var j=$("textarea[name='description']").val();if(j==""){j=" ";}$.ajax({type:"get",url:"/app/save?name="+h+"&platform="+g+"&description="+j+"&id="+d,dataType:"json",data:"rnd="+Math.random(),beforeSend:function(k){},success:function(k,m){if(k.status=="ok"){var l=c.parent().parent().find("td:eq(0)");
l.append("<div class='loading_row'><div class='txt'>正在刷新数据&nbsp;&nbsp;&nbsp;<img src='images/loading_m.gif' /></div></div>");updateItem(c.parent().parent(),h,g);
$.unblockUI({onUnblock:function(){appDialogId="";}});}},complete:function(k,l){},error:function(){}});}});},complete:function(e,f){},error:function(){}});
}function showMask(){var b=$(".panel_table").css("height").replace("px","");var a=b/2-58;$(".loading").css("display","block").css("padding-top",a+"px").css("height",(b-a)+"px");
}function hideMask(){$(".loading").css("display","none");}function adjustMsg(){var a=$(".msg_app").is(":visible")?$(".msg_app"):$(".msg_ad");$("body>.blockMsg").stop().animate({top:$(window).height()/2-(a.height()/2)+"px"},300);
}