var status,appDialogId="";$(function(){loadList(1);$(".btn_add_app").click(function(){appDialogId=getToken();initMsg({},function(){$.unblockUI({onUnblock:function(){appDialogId="";
$("body").css({"overflow-y":"auto"});}});loadList(1);});});});function clearList(){$("#tb_list tr").each(function(a){if($(this).attr("class")!="tit"){$(this).remove();
}});}function loadList(b,a){$.ajax({type:"get",url:"app/list?pageNo="+b+(a?a:""),dataType:"json",data:"rnd="+Math.random(),beforeSend:function(c){},success:function(g,e){var k=g;
var d=k.appPage.result;var h=k.appPage.totalPages;var c=k.appPage.pageNo;var j=d.length;var l=true;clearList();pageAnchorsGenerate(h,c,"",loadList);if(!k.appPage||k.appPage.result.length===0){$("#tb_list tr").not(":first").remove();
$("#tb_list").append('<tr id="loading_row_init"><td colspan="4">没有记录!</td></tr>');return;}for(i=0;i<j;i++){var f="";f+="<tr class="+(l===true?"":"transbg")+' id="tr_'+d[i].id+'">';
l=!l;f+='<td class="pos_rel chk" style="display:block"><input type="checkbox" name="record_ch" value="'+d[i].id+'"></td>';f+='<td><a href="javascript:void(0)" onclick="editApp('+d[i].id+',event)" class="tb_name">'+d[i].name+"</a></td>";
f+='<td id="td_status_'+d[i].id+'" style="text-align:left; padding:0 30px;">';if(d[i].status.indexOf("normal")>-1){f+='<img src="images/icon_state_normal.gif" width="16" height="16" alt="正常" />正常';
}else{f+='<img src="images/icon_state_pause.gif" width="16" height="16" alt="暂停" />暂停';}f+="</td>";f+='<td class="tb_platform">'+d[i].platform+"</td>";
f+="<td>"+d[i].ad_slot_count+"</td>";f+='<td><a href="javascript:void(0)" class="icon_modify" onclick="editApp('+d[i].id+',event)">编辑</a></td>';f+="</tr>";
$("#tb_list").append(f);}},complete:function(c,d){},error:function(){}});}function updateItem(c,b,a){setTimeout(function(){$(".loading_row").remove();c.find(".tb_name").html(b);
c.find(".tb_platform").html(a);},1000);}function initMsg(c,e,d){$(".err").remove();if(c.name&&c.name!==""){$(".msg_content_top .title span").eq(0).text("编辑应用");
}else{$(".msg_content_top .title span").eq(0).text("新建应用");}$("input[name='name']").val(c.name);$(".ui_radio").removeClass("ui_radio_checked");if(c.platform&&c.platform=="android"){$(".android").parent().addClass("ui_radio_checked");
$("input[name='platform']").val(c.platform);}else{if(c.platform&&c.platform=="iOS"){$(".ios").parent().addClass("ui_radio_checked");$("input[name='platform']").val(c.platform);
}}$("textarea[name='description']").val(c.description?c.description:"");var b=$(".msg_app");popBox(b);$(".close").unbind("click").click(function(){$.unblockUI({onUnblock:function(){appDialogId="";
$("body").css({"overflow-y":"auto"});}});});$(".ui_radio_os").click(function(){$(".ui_radio_os").removeClass("ui_radio_checked");$(this).addClass("ui_radio_checked");
});function a(){if(verify_null($("input[name='name']"),"应用名称不能为空！")&&verify_null($("input[name='platform']"),"平台不能为空！",true)){var g=this;$(g).unbind("click");
var h=$("input[name='name']").val();var f=$("input[name='platform']").val();var j=$("textarea[name='description']").val();$.ajax({type:"get",url:"/app/save?name="+h+"&platform="+f+"&description="+j+(d?("&id="+d):""),dataType:"json",data:"rnd="+Math.random(),beforeSend:function(k){},success:function(k,l){if(k.status=="ok"){e();
}},complete:function(k,l){},error:function(){alert("保存失败!");$(".btn_save").unbind("click").click(function(){a.apply(this);});}});}}$(".btn_save").unbind("click").click(function(){a.apply(this);
});}function editApp(d,a){var c=null;c=$(a.target);var b=appDialogId=getToken();$.ajax({type:"get",url:"/app/edit/"+d,dataType:"json",data:"rnd="+Math.random(),beforeSend:function(e){},success:function(e,f){if(b!=appDialogId){return;
}initMsg(e.app,function(){var h=$("input[name='name']").val();var g=$("input[name='platform']").val();var j=c.parent().parent().find("td:eq(0)");j.append("<div class='loading_row'><div class='txt'>正在刷新数据&nbsp;&nbsp;&nbsp;<img src='images/loading_m.gif' /></div></div>");
updateItem(c.parent().parent(),h,g);$.unblockUI({onUnblock:function(){appDialogId="";$("body").css({"overflow-y":"auto"});}},d);});},complete:function(e,f){},error:function(){}});
}function showMask(){var b=$(".panel_table").css("height").replace("px","");var a=b/2-58;$(".loading").css("display","block").css("padding-top",a+"px").css("height",(b-a)+"px");
}function hideMask(){$(".loading").css("display","none");}