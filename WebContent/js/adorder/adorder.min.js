var adOrderDialogId="",adList={};$(function(){$(".local_date").each(function(c){var b=new Date($(this).text());$(this).text(b.getFullYear()+"-"+b.getMonth()+"-"+b.getDay());
});loadList(1);adList=new window.AdList();adList.initUI();var a=new window.AddAd({addButtonLisner:"#tb_list"});a.initUI();a.region.initUI();$("#datepicker_start_adorder").datetimepicker({dateFormat:"yy-mm-dd",changeYear:true,changeMonth:true,monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesMin:["日","一","二","三","四","五","六"],timeText:"时间",hourText:"时",minuteText:"分",currentText:"现在",closeText:"确定",onClose:function(f,e){var c=$("#datepicker_end_adorder");
if(c.val()!==""){var d=new Date(f);var b=new Date(c.val());if(d>b){c.val(f);}}else{c.val(f);}$(this).blur();},onSelect:function(c){var b=$(this).datetimepicker("getDate");
$("#datepicker_end_adorder").datetimepicker("option","minDate",new Date(b.getTime()));}});$("#datepicker_end_adorder").datetimepicker({dateFormat:"yy-mm-dd",changeYear:true,changeMonth:true,monthNamesShort:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayNames:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],dayNamesMin:["日","一","二","三","四","五","六"],timeText:"时间",hourText:"时",minuteText:"分",currentText:"现在",closeText:"确定",onClose:function(f,e){var d=$("#datepicker_start_adorder");
if(d.val()!==""){var c=new Date(d.val());var b=new Date(f);if(c>b){d.val(f);}}else{d.val(f);}$(this).blur();},onSelect:function(c){var b=$(this).datetimepicker("getDate");
$("#datepicker_start_adorder").datetimepicker("option","maxDate",new Date(b.getTime()));}});$(".btn_add_order").click(function(){adOrderDialogId=getToken();
$("input[name='id']").val("");showMsg(new ADOrder(),function(){$.unblockUI({onUnblock:function(){adOrderDialogId="";$("body").css({"overflow-y":"auto"});
}});loadList(1);});});});function loadList(b,a){$.ajax({type:"get",url:"adorder/list?pageNo="+b+(a?a:""),dataType:"json",data:"rnd="+Math.random(),beforeSend:function(c){},success:function(g,d){loginValidate(g);
var k=g.adOrderPage;var f=k.result;var h=k.totalPages;var c=k.pageNo;var j=f.length;var l=true;clearList();pageAnchorsGenerate(h,c,"",loadList);if(!k||k.result.length===0){$("#tb_list tr").not(":first").remove();
$("#tb_list").append('<tr id="loading_row_init"><td colspan="4">没有记录!</td></tr>');return;}for(i=0;i<j;i++){var e="";e+='<tr class="'+(l===true?"":"transbg")+'"  id="tr_'+f[i].id+'">';
l=!l;e+='<td class="chk pos_rel" style="display:block"><input type="checkbox" name="record_ch" value="'+f[i].id+'" /></td>';e+='<td><a href="javascript:void(0);" onclick="editAdOrder('+f[i].id+',event)" class="tb_name">'+f[i].name+"</a></td>";
e+='<td id="td_status_'+f[i].id+'" style="text-align: left; padding: 0 10px;">';if(f[i].status==="normal"){e+='<img src="images/icon_state_normal.gif" width="16" height="16" alt="正常" />正常';
}else{if(f[i].status==="finish"){e+='<img src="images/icon_state_complete.gif" width="16" height="16" alt="订单完成" />订单完成';}else{if(f[i].status==="ready"){e+='<img src="images/icon_state_abled.gif" width="16" height="16" alt="尚未投放" />尚未投放';
}else{if(f[i].status==="pause"){e+='<img src="images/icon_state_pause.gif" width="16" height="16" alt="暂停" />暂停';}else{e+='<img src="images/icon_state_pause.gif" width="16" height="16" alt="未知" />未知';
}}}}e+="</td>";e+='<td class="tb_customer">'+(f[i].customer&&f[i].customer!==""?f[i].customer:"-")+"</td>";e+='<td class="local_date tb_startTime">'+formatdate(new Date(f[i].start_time),"yyyy-MM-dd HH:mm")+"</td>";
e+='<td class="local_date tb_endTime">'+(f[i].end_time?formatdate(new Date(f[i].end_time),"yyyy-MM-dd HH:mm"):"-")+"</td>";e+='<td><a href="javascript:void(0);" class="icon_modify" onclick="editAdOrder('+f[i].id+',event)">编辑</a>';
e+='<a class="icon_expend_rev extend" href="javascript:void(0)">展开广告</a></td></tr>';$("#tb_list").append(e);}},complete:function(c,d){},error:function(){}});
}function clearList(){$("#tb_list tr").each(function(a){if($(this).attr("class")!="tit"){$(this).remove();}});}function showMask(){var b=$(".panel_table").css("height").replace("px","");
var a=b/2-58;$(".loading").css("display","block").css("padding-top",a+"px").css("height",(b-a)+"px");}function hideMask(){$(".loading").css("display","none");
}function ADOrder(h,b,f,c,a,g){this.id=h;this.name=b;this.customer=f;this.comments=g;this.startTime=c;try{if(a.toString().trim()!="00:00:00"){this.endTime=a;
}}catch(d){}}function getADOrder(){var f=$("input[name='id']").val();var b=$("input[name='name']").val();var d=$("input[name='customer']").val();var c=($("#datepicker_start_adorder").val().trim()+" 00:00").replace(/(\d{2}:\d{2})\s?(00:00)?\s?/,"$1:00");
var a=($("#datepicker_end_adorder").val().trim()+" 00:00").replace(/(\d{2}:\d{2})\s?(00:00)?\s?/,"$1:00");var e=$('textarea[name="comments"]').val();return new ADOrder(f,b,d,c,a,e);
}function initMsg(a){$(".err").remove();$("input[name='name']").val("");$("input[name='customer']").val("");$(".input_textarea").val("");$("#datepicker_start_adorder").val("");
$("#datepicker_end_adorder").val("");if(a.name){$("input[name='name']").val(a.name);}if(a.customer){$("input[name='customer']").val(a.customer);}if(a.startTime){$("#datepicker_start_adorder").val(formatdate(new Date(a.startTime),"yyyy-MM-dd HH:mm"));
}if(a.endTime){$("#datepicker_end_adorder").val(formatdate(new Date(a.endTime),"yyyy-MM-dd HH:mm"));}if(a.comments){$('textarea[name="comments"]').val(a.comments);
}}function showMsg(b,f){initMsg(b);var a=$(window).height();var d=$(document).width();var e=$(".msg_order");popBox(e);$(".close").unbind("click").click(function(){$.unblockUI({onUnblock:function(){adOrderDialogId="";
$("body").css({"overflow-y":"auto"});}});});function c(){if(verify_null($("input[name='name']"),"订单名称不能为空！")&&verify_null($("#datepicker_start_adorder"),"开始时间不能为空",false,$("#datepicker_end_adorder"))){var g=this;
$(g).unbind("click");var j=getADOrder();var h="/adorder/save";j.rnd=Math.random(),$.ajax({type:"get",url:h,data:j,dataType:"json",beforeSend:function(k){},success:function(k,l){loginValidate(k);
if(k.status=="ok"){}},complete:function(k,l){f();},error:function(){alert("保存出错!");$(g).unbind("click").click(function(){c.apply(g);});}});}}$(".btn_save_order").unbind("click").click(function(){c.apply(this);
});}function editAdOrder(d,a){$("input[name='id']").val(d);var c=$(a.target);var b=adOrderDialogId=getToken();$.ajax({type:"get",url:"/adorder/edit/"+d,dataType:"json",data:"rnd="+Math.random(),beforeSend:function(e){},success:function(f,g){loginValidate(f);
if(b!=adOrderDialogId){return;}var e=new ADOrder(f.adOrder.id,f.adOrder.name,f.adOrder.customer,f.adOrder.startTime,f.adOrder.endTime,f.adOrder.comments);
showMsg(e,function(){var h=c.parent().parent().find("td:eq(0)");h.append("<div class='loading_row'><div class='txt'>正在刷新数据&nbsp;&nbsp;&nbsp;<img src='images/loading_m.gif' /></div></div>");
updateItem(c.parent().parent(),$("input[name='name']").val(),$("#datepicker_start_adorder").val(),$("#datepicker_end_adorder").val(),$("input[name='customer']").val());
$.unblockUI({onUnblock:function(){adOrderDialogId="";$("body").css({"overflow-y":"auto"});}});});},complete:function(e,f){},error:function(){alert("编辑失败!");
}});}function updateItem(e,b,c,a,d){setTimeout(function(){$(".loading_row").remove();e.find(".tb_name").html(b);e.find(".tb_startTime").html(c);e.find(".tb_endTime").html(a);
e.find(".tb_customer").html(d==""?"-":d);},1000);}