<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.umeng.ufp.core.domain.AdHolder">
  <resultMap id="AdHolder-RESULT" type="com.umeng.ufp.core.domain.AdHolder">
    
    <result column="ad_id" jdbcType="INTEGER" property="adId" />
    <result column="ad_slot_id" jdbcType="INTEGER" property="adSlotId" />
    <result column="prior" jdbcType="INTEGER" property="prior" />
    <result column="ctr" jdbcType="DOUBLE" property="ctr" />
    <result column="weight" jdbcType="DOUBLE" property="weight" />
	<result column="adslot_state" jdbcType="INTEGER" property="adSlotState" />
	<result column="ad_state" jdbcType="INTEGER" property="adState" />
    <result column="user_id" jdbcType="INTEGER" property="userId" />
  </resultMap>
  
  	<sql id="select">
		select *
		from
		ad_holder
	</sql>

	<select id="AdHolder.getMapListByMap" resultType="java.util.HashMap" parameterType="java.util.Map">
		<include refid="select" />
		<where>
		<if test="adSlotId != null and adSlotId != ''">
			and ad_slot_id = #{adSlotId}
		</if>
		<if test="adId != null and adId != ''">
			and ad_id = #{adId}
		</if>
		</where>
	</select>
    
    <select id="AdHolder.find" resultMap="AdHolder-RESULT" parameterType="java.util.Map">
        <![CDATA[
        select *
        from ad_holder
        ]]>
        <where>
        	<![CDATA[!((adslot_state | ad_state) & 1)]]>
            <if test="adId != null and adId != ''">
                  and ad_id = #{adId}
            </if>
            <if test="adSlotId != null and adSlotId != ''">
                  and ad_slot_id = #{adSlotId}
            </if>
            <if test="adState != null">
            	  and ad_state = #{adState}
            </if> 
        </where>
    </select>
    <select id="AdHolder.findIds" resultType="java.lang.Integer" parameterType="java.lang.Integer">
        select 
        <if test="adId != null and adId != ''">
        	ad_slot_id
        </if>
        <if test="adSlotId != null and adSlotId != ''">
        	ad_id
        </if>
        from ad_holder
        <where>
        	<![CDATA[!((adslot_state | ad_state) & 1)]]>
	        <if test="adId != null and adId != ''">
	            and ad_id = #{adId}
	        </if>   
	        <if test="adSlotId != null and adSlotd != ''">
	            and ad_slot_id = #{adSlotId}
	        </if>
       </where>     
  	</select>
	<select id="AdHolder.listQuery" resultType="java.util.HashMap" parameterType="java.util.Map">
		<include refid="select" />
		order by ad_id desc
	</select>  
	
	<select id="AdHolder.listQueryPage" resultType="java.util.HashMap" parameterType="java.util.Map"> 
	    select prior, ad_state, adslot_state, ad_slot_id, ad_id from ad_holder 
		<where>
        	<![CDATA[!((adslot_state | ad_state) & 1)]]>
			<if test="adSlotIdList != null and adSlotIdList != ''">
				and ad_slot_id in
                <foreach item="adslotid" collection="adSlotIdList" open="(" close=")"
                    separator=",">
                    #{adslotid}
                </foreach>
			</if>
			<if test="adIdList != null and adIdList != ''">
				and ad_id in
                <foreach item="adid" collection="adIdList" open="(" close=")"
                    separator=",">
                    #{adid}
                </foreach>
			</if>
			<if test="adSlotId != null and adSlotId != ''">
				and ad_slot_id = #{adSlotId}
			</if>
			<if test="adId != null and adId != ''">
				and ad_id = #{adId}
			</if>
			<if test="userId != null and userId != ''">
				and user_id = #{userId}
			</if>
		</where>    
		order by ad_id desc
		 <if test="limit != null">
		     limit
		     <if test="offset != null">
		         #{offset},
		     </if>
		     #{limit}
		 </if>
	</select>

	<select id="AdHolder.listQueryPagecount" resultType="java.lang.Integer" parameterType="java.util.Map">
        select count(*) from ad_holder
        <where>
        	<![CDATA[!((adslot_state | ad_state) & 1)]]>
        	<if test="adSlotId != null and adSlotId != ''">
        		and ad_slot_id = #{adSlotId}
        	</if>
        	<if test="adId != null and adId != ''">
        		and ad_id = #{adId}
        	</if>
        </where>
	</select>
    
	<insert id="AdHolder.insert" parameterType="com.umeng.ufp.core.domain.AdHolder" useGeneratedKeys="true" keyProperty="id">
		insert into ad_holder(created_time, updated_time
		    <if test="adId != null and adId != ''">,ad_id</if>
		    <if test="adSlotId != null and adSlotId != ''">,ad_slot_id</if>
		    <if test="prior != null and prior != ''">,prior, weight</if>
		    <if test="adState != null">,ad_state</if>
		    <if test="adSlotState != null">,adslot_state</if>
		    <if test="userId != null and userId !=''">,user_id</if>
	    ) values(SYSDATE(), SYSDATE()
		    <if test="adId != null and adId != ''">,#{adId}</if>
		    <if test="adSlotId != null and adSlotId != ''">,#{adSlotId}</if>
		    <if test="prior != null and prior != ''">,#{prior},#{prior}</if>
		    <if test="adState != null">,#{adState}</if>
		    <if test="adSlotState != null">,#{adSlotState}</if>
		    <if test="userId != null and userId !=''">,#{userId}</if>
	    ) on duplicate key update updated_time = SYSDATE()
		    <if test="adState != null">
		    	,ad_state = #{adState}
		    </if>
		    <if test="adSlotState != null">
		    	,adslot_state = #{adSlotState}
		    </if>
		    <if test="userId != null and userId !=''">
		    	,user_id = #{userId}
		    </if>
		    <if test="prior != null and prior != ''">
		    	,prior = #{prior}
		    	,weight= #{prior}
		    </if>
	</insert>
	
	<update id="AdHolder.update" parameterType="com.umeng.ufp.core.domain.AdHolder">
	    insert into ad_holder( created_time, updated_time
		    <if test="adId != null and adId != ''">,ad_id</if>
		    <if test="adSlotId != null and adSlotId != ''">,ad_slot_id</if>
		    <if test="prior != null and prior != ''">,prior, weight</if>
		    <if test="adState != null">,ad_state</if>
		    <if test="adSlotState != null">,adslot_state</if>
		    <if test="userId != null and userId !=''">,user_id</if>
	    ) values(SYSDATE(), SYSDATE()
		    <if test="adId != null and adId != ''">,#{adId}</if>
		    <if test="adSlotId != null and adSlotId != ''">,#{adSlotId}</if>
		    <if test="prior != null and prior != ''">,#{prior},#{prior}</if>
		    <if test="adState != null">,#{adState}</if>
		    <if test="adSlotState != null">,#{adSlotState}</if>
		    <if test="userId != null and userId !=''">,#{userId}</if>
	    ) on duplicate key update updated_time = SYSDATE()
		    <if test="adState != null">
		    	,ad_state = #{adState}
		    </if>
		    <if test="adSlotState != null and adSlotState !=''">
		    	,adslot_state = #{adSlotState}
		    </if>
		    <if test="prior != null and prior != ''">
		    	,prior = #{prior}
		    	,weight=#{prior}
		    </if>
	</update>
	<delete id="AdHolder.updateByMap" parameterType="java.util.Map">
        update ad_holder
        set updated_time = SYSDATE()
        <if test="(adAndState != null and adAndState != '') 
        	or (adOrState != null and adOrState != '')">
        	,ad_state = ad_state
       		<if test="adAndState != null and adAndState != ''">
       			<![CDATA[ & #{adAndState}]]>
       		</if>
       		<if test="adOrState != null and adOrState != '' ">
       			<![CDATA[ | #{adOrState}]]>
       		</if>
        </if>
        <if test="(adSlotAndState != null and adSlotAndState != '') 
        	or (adSlotOrState != null and adSlotOrState != '')">
        	,adslot_state = adslot_state
       		<if test="adSlotAndState != null and adSlotAndState != ''">
       			<![CDATA[ & #{adSlotAndState}]]>
       		</if>
       		<if test="adSlotOrState != null and adSlotOrState != '' ">
       			<![CDATA[ | #{adSlotOrState}]]>
       		</if>
        </if>
        <if test="prior != null">
        	,prior = #{prior}
        </if>
        <where>
            <if test="adIdList != null and adIdList != ''">
                and ad_id in
                <foreach item="adid" collection="adIdList" open="(" close=")"
                    separator=",">
                    #{adid}
                </foreach>
            </if>
            <if test="adSlotIdList != null and adSlotIdList != ''">
                and ad_slot_id in
                <foreach item="adslotid" collection="adSlotIdList" open="(" close=")"
                    separator=",">
                    #{adslotid}
                </foreach>
            </if>
            <if test="userId != null and userId != ''">
            	and user_id = #{userId}
            </if>
        </where>
    </delete>

</mapper>

