<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.umeng.ufp.core.domain.AdSlot">
  <resultMap id="AdSlot-RESULT-BASIC" type="com.umeng.ufp.core.domain.AdSlot">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column = "user_id" jdbcType="INTEGER" property="userId" />
    
    <result column="app_id" jdbcType="BOOLEAN" property="appId" />
    <result column="name" jdbcType="VARCHAR" property="name" />
	<result column="state" jdbcType="INTEGER" property="state" />

    <result column="landing_type" jdbcType="VARCHAR" property="landingType" />
    <result column="landing_size" jdbcType="VARCHAR" property="landingSize" />
    <result column="platform" jdbcType="VARCHAR" property="platform" />
  </resultMap>
  <resultMap id="AdSlot-RESULT" type="com.umeng.ufp.core.domain.AdSlot" extends="AdSlot-RESULT-BASIC">
    <result column="landing_images" jdbcType="VARCHAR" property="landingImages" />

    <result column="style" jdbcType="VARCHAR" property="style" />
    <result column="device" jdbcType="VARCHAR" property="device" />
    <result column="channels" jdbcType="VARCHAR" property="channels" />
    <result column="areas" jdbcType="VARCHAR" property="areas" />
    <result column="text_size" jdbcType="VARCHAR" property="textSize" />
    <result column="display_strategy" jdbcType="VARCHAR" property="displayStrategy" />
    <result column="timeslots" jdbcType="VARCHAR" property="timeslots" />
    <result column="template" jdbcType="VARCHAR" property="template" />
    <result column="anim_in" jdbcType="VARCHAR" property="animIn" />
    <result column="display_rate" jdbcType="VARCHAR" property="displayRate" />
    <result column="enable_preload" jdbcType="VARCHAR" property="enablePreload" />
    <result column="enable_page" jdbcType="VARCHAR" property="enablePage" />

    <result column="ad_network_strategy" jdbcType="VARCHAR" property="adNetworkStrategy" />
    <result column="xp_enable" javaType="BOOLEAN" jdbcType="BIT" property="xpEnable" />
    <result column="xp_percent" jdbcType="INTEGER" property="xpPercent" />
    <result column="appkey" jdbcType="VARCHAR" property="appkey" />
    <result column="uads_enable" javaType="BOOLEAN" jdbcType="BIT" property="uadsEnable" />
    <result column="uads_percent" jdbcType="INTEGER" property="uadsPercent" />
    <result column="uads_key" jdbcType="VARCHAR" property="uadsKey" />
    <result column="uads_key2" jdbcType="VARCHAR" property="uadsKey2" />
    <result column="opensize" jdbcType="VARCHAR" property="opensize" />
    <result column="push_strategy" jdbcType="VARCHAR" property="pushStrategy" />
    <result column="enable_new" jdbcType="VARCHAR" property="enableNew" />
    <result column="interval" jdbcType="INTEGER" property="interval" />
    <result column="filter" jdbcType="INTEGER" property="filter" />

  </resultMap>
  <resultMap id="AdSlot-RESULT-MAP" type="java.util.HashMap" extends="AdSlot-RESULT-BASIC">
	<result column="app_name" jdbcType="VARCHAR" property="appName" />
  </resultMap>
  
	<sql id="select">
		select *
		from
		ad_slot
	</sql>

	<select id="AdSlot.get" resultMap="AdSlot-RESULT" parameterType="int">
		<include refid="select" />
		<where>
			id = #{id}
        </where> 
	</select>
	
	<select id="AdSlot.getMapById" resultType="java.util.HashMap" parameterType="int">
		<include refid="select" />
		<where>
			id = #{id}
		</where>
	</select>
  
	<select id="AdSlot.find" resultMap="AdSlot-RESULT" parameterType="java.util.Map">
        <include refid="select" />
        <where>
			<!-- !(state & 1( means that status not delete -->
        	<![CDATA[!(state & 1)]]>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="userId != null and userId != ''">
            	and user_id = #{userId}
            </if>  
            <if test="adSlotIdList != null and adSlotIdList != ''">
                and id in
                <foreach item="adslotid" collection="adSlotIdList" open="(" close=")"
                    separator=",">
                    #{adslotid}
                </foreach>
            </if>
        </where>
    </select>
	<select id="AdSlot.listQueryPage" resultType="java.util.HashMap" parameterType="java.util.Map">
		select ad_slot.*,
		(select name from app where ad_slot.app_id = app.id) as app_name
		from ad_slot
		<where>
			<!-- !(state & 1( means that status not delete -->
        	<![CDATA[!(state & 1)]]>
        	<if test="status != null and status != ''">
		         and
				<foreach item="s" collection="status" open="(" close=")"
		             separator=" or ">
		             <!-- state & (state -1 ) means set lowest bit from 1 to 0 -->
				     <!-- state ^ (state & (state -1 )) means get proir highest state -->
		             <choose>
			             <when test="s == 'normal'">
			             	state = 0
			             </when>
			             <when test="s == 'pause'">
				             <![CDATA[((state ^ (state & (state - 1))) & 2)]]>
			             </when>
			             <when test="s == 'app_pause'">
				             <![CDATA[((state ^ (state & (state - 1))) & 64)]]>
			             </when>
		             </choose>
		        </foreach>      
		    </if>
		    <if test="platform != null and platform != ''">
            	 and platform = #{platform}
            </if>
	        <if test="userId != null and userId != ''">
            	 and user_id = #{userId}
            </if> 
		</where>
		order by id desc
		 <if test="limit != null">
		     limit
		     <if test="offset != null">
		         #{offset},
		     </if>
		     #{limit}
		 </if>
	</select>
	
	<select id="AdSlot.count" resultType="java.lang.Integer" parameterType="java.util.Map">
		select count(id) from ad_slot
		<where>
			<!-- !(state & 1( means that not delete -->
        	<![CDATA[!(state & 1)]]>
			<if test="userId != null and userId != ''">
				and user_id = #{userId}	
			</if>
			<if test="appId != null and appId != ''">
				and app_id = #{appId}
			</if>
		</where>
	</select>
	<select id="AdSlot.listQueryPagecount" resultType="java.lang.Integer" parameterType="java.util.Map">
   		<![CDATA[
        select count(id)
        from ad_slot
        ]]>
        <where>
			<!-- !(state & 1( means that not delete -->
        	<![CDATA[!(state & 1)]]>
            <if test="userId != null and userId != ''">
            	and user_id = #{userId}
            </if> 
            <if test="status != null and status != ''">
		         and
				<foreach item="s" collection="status" open="(" close=")"
		             separator=" or ">
		             <!-- state & (state -1 ) means set lowest bit from 1 to 0 -->
				     <!-- state ^ (state & (state -1 )) means get proir highest state -->
		             <choose>
			             <when test="s == 'normal'">
			             	state = 0
			             </when>
			             <when test="s == 'pause'">
				             <![CDATA[((state ^ (state & (state - 1))) & 2)]]>
			             </when>
			             <when test="s == 'app_pause'">
				             <![CDATA[((state ^ (state & (state - 1))) & 64)]]>
			             </when>
		             </choose>
		        </foreach>      
		    </if> 
        </where>
	</select>
  
	<insert id="AdSlot.insert" parameterType="com.umeng.ufp.core.domain.AdSlot" useGeneratedKeys="true" keyProperty="id">
	    insert into ad_slot(user_id, created_time, updated_time, name, platform, enable_preload, enable_page, app_id
	    	,landing_images, landing_size, landing_type, device, areas, text_size, display_strategy, channels, timeslots
		    <if test="template != null and template != ''">,template</if>
		    <if test="animIn != null and animIn != ''">,anim_in</if>
		    ,ad_network_strategy
		    <if test="xpEnable != null">,xp_enable</if>
		    <if test="xpPercent != null">,xp_percent</if>
		    <if test="appkey != null and appkey != ''">,appkey</if>
		    <if test="uadsEnable != null">,uads_enable</if>
		    <if test="uadsPercent != null">,uads_percent</if>
		    <if test="uadsKey != null and uadsKey != ''">,uads_key</if>	
		    <if test="opensize != null and opensize != 'none'">,opensize</if>	
		    <if test="pushStrategy != null and pushStrategy != 'none'">,push_strategy</if>
		    <if test="interval != null">,`interval`</if>
		    <if test="filter != null">,`filter`</if>
		    , enable_new			   	   
		) values(#{userId}, SYSDATE(), SYSDATE(), #{name}, #{platform}, #{enablePreload}, #{enablePage}, #{appId}
			,#{landingImages}, #{landingSize}, #{landingType}, #{device}, #{areas}, #{textSize}, #{displayStrategy}, #{channels}, #{timeslots}
		    <if test="template != null and template != ''">,#{template}</if>
		    <if test="animIn != null and animIn != ''">,#{animIn}</if>
	        ,#{adNetworkStrategy}
		    <if test="xpEnable != null">,#{xpEnable}</if> 
	        <if test="xpPercent != null">,#{xpPercent}</if>
	        <if test="appkey != null and appkey != ''">,#{appkey}</if>
		    <if test="uadsEnable != null">,#{uadsEnable}</if> 
		    <if test="uadsPercent != null">,#{uadsPercent}</if>
		    <if test="uadsKey != null and uadsKey != ''">,#{uadsKey}</if>
		    <if test="opensize != null and opensize != 'none'">,#{opensize}</if>
		    <if test="pushStrategy != null and pushStrategy != 'none'">,#{pushStrategy}</if>  
		    <if test="interval != null">,#{interval}</if>
		    <if test="filter != null">,#{filter}</if>
		    ,#{enableNew}
	    )
	</insert>
	<insert id="AdSlot.update" parameterType="com.umeng.ufp.core.domain.AdSlot">
	update ad_slot set updated_time = SYSDATE()
	    ,app_id = #{appId}
	    ,name = #{name}, platform = #{platform}, landing_images = #{landingImages}, landing_size = #{landingSize}
	    ,landing_type = #{landingType}, device = #{device}, channels = #{channels}, areas = #{areas}, text_size = #{textSize}
	    ,display_strategy = #{displayStrategy}, enable_preload = #{enablePreload}, enable_new = #{enableNew}, 
	    enable_page = #{enablePage}, timeslots = #{timeslots}, opensize = #{opensize}, push_strategy = #{pushStrategy}
	    <if test="template != null and template != ''">,template = #{template}</if>
	    <if test="animIn != null and animIn != ''">,anim_in= #{animIn}</if>
	    ,ad_network_strategy = #{adNetworkStrategy}
		<if test="xpEnable != null">,xp_enable = #{xpEnable}</if>  
	    <if test="xpPercent != null">,xp_percent = #{xpPercent}</if>	    
	    <if test="appkey != null and appkey != ''">,appkey = #{appkey}</if>  
		<if test="uadsEnable != null">,uads_enable = #{uadsEnable}  </if>  
	    <if test="uadsPercent != null">,uads_percent = #{uadsPercent} </if>	    
	    <if test="uadsKey!= null and appkey != ''">,uads_key = #{uadsKey} </if>	  
	    <if test="interval != null">,`interval` = #{interval}</if>  
	    <if test="filter != null">,`filter` = #{filter}</if>  
	    <where>
	    	id = #{id} 
			<!-- !(state & 1( means that not delete -->
        	<![CDATA[and !(state & 1)]]>
            <if test="userId != null and userId != ''">
            	and user_id = #{userId}
            </if>  
	    </where>
	</insert>
	<update id="AdSlot.updateByMap" parameterType="java.util.Map">
        update ad_slot
        set updated_time = SYSDATE()
        <if test="(andState != null and andState != '') 
        	or (orState != null and orState != '')">
        	,state = state
       		<if test="andState != null and andState != ''">
       			<![CDATA[ & #{andState}]]>
       		</if>
       		<if test="orState != null and orState != '' ">
       			<![CDATA[ | #{orState}]]>
       		</if>
        </if>
        <if test="name != null">
            ,name = #{name}
        </if>
        <where>
			<!-- !(state & 1( means that status not delete -->
        	<![CDATA[!(state & 1)]]>
            <if test="appId != null and appId != ''">
                and app_id = #{appId}
            </if>
            <if test="id != null and id != ''">
                and id = #{id}
            </if>
            <if test="adSlotIdList != null and adSlotIdList != ''">
                and id in
                <foreach item="adslotid" collection="adSlotIdList" open="(" close=")"
                    separator=",">
                    #{adslotid}
                </foreach>
            </if>
            <if test="userId != null and userId != ''">
            	and user_id = #{userId}
            </if>  
        </where>
    </update>
    <select id="AdSlot.findIds" resultType="java.lang.Integer" parameterType="java.lang.Integer">
        select id
        from ad_slot
        <where>
			<!-- !(state & 1( means that status not delete -->
        	<![CDATA[!(state & 1)]]>
	        <if test="appId != null and appId != ''">
	            and app_id = #{appId}
	        </if>   
	        <if test="userId != null and userId != ''">
	            and user_id = #{userId}
	        </if>
       </where>     
  	</select>
	<delete id="AdSlot.delete" parameterType="java.util.Map">
		update ad_slot 
			 set updated_time = SYSDATE()
			 <if test="id != null and id != ''">
			 	,app_id = null
			 </if>
			 
		<where>
			<!-- !(state & 1( means that status not delete -->
        	<![CDATA[!(state & 1)]]>
			 <if test="id != null and id != ''">
			 	and id = #{id}
			 </if>
		</where> 
	</delete>
      
</mapper>
